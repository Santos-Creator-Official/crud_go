name: Golang CI/CD

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set PATH for Go
        run: echo "PATH=$PATH:/usr/local/go/bin" >> $GITHUB_ENV

      - name: Build Go application
        run: |
          whoami
          cd /var/www/crud_go
          go mod tidy
          go build -o crud_go

      - name: Check & Restart Service
        run: |
          if systemctl is-active --quiet myapp; then
            echo "Service is running, restarting..."
            systemctl restart crud_go
          else
            echo "Service is not running, starting..."
            systemctl start crud_go
          fi
